<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loan Tracker</title>

<style>
:root {
  --bg:#f4f4f4; --card:#fff; --text:#000; --accent:#007aff;
}
.dark {
  --bg:#121212; --card:#1e1e1e; --text:#fff;
}
body {
  margin:0; font-family:system-ui; background:var(--bg); color:var(--text);
}
header {
  padding:12px; background:var(--accent); color:#fff;
  display:flex; justify-content:space-between; align-items:center;
}
button, input, select {
  width:100%; padding:10px; margin:6px 0;
}
button {
  background:var(--accent); color:#fff; border:none; border-radius:6px;
}
.card {
  background:var(--card); margin:12px; padding:12px; border-radius:8px;
}
.row { display:flex; gap:8px; }
.small { font-size:14px; opacity:0.7; }
.positive { color:green; }
.negative { color:red; }
.list-item {
  display:flex; justify-content:space-between; align-items:center;
  padding:6px 0;
}
.list-item span { cursor:pointer; }
</style>
</head>

<body>

<header>
  <strong>Loan Tracker</strong>
  <button onclick="toggleDark()">üåô</button>
</header>

<div class="card">
  <h3>Settings</h3>
  <input id="currency" placeholder="Currency symbol (‚Çπ, $, ‚Ç¨)">
  <input id="password" placeholder="Set password (optional)">
  <button onclick="saveSettings()">Save Settings</button>
</div>

<div class="card">
  <h3>Add Person</h3>
  <input id="newPerson" placeholder="Person name">
  <button onclick="addPerson()">Add</button>
</div>

<div class="card">
  <h3>Add Transaction</h3>
  <select id="personSelect"></select>
  <select id="type">
    <option value="borrow">Borrow</option>
    <option value="repay">Repay</option>
  </select>
  <input id="amount" type="number" placeholder="Amount">
  <button onclick="addTransaction()">Save</button>
</div>

<div class="card">
  <h3>Balances</h3>
  <div id="balances"></div>
  <strong>Total: <span id="total">0</span></strong>
</div>

<div class="card">
  <h3>Transactions</h3>
  <div id="history"></div>
</div>

<div class="card">
  <h3>Backup</h3>
  <button onclick="exportData()">Export Backup</button>
  <input type="file" onchange="importData(event)">
</div>

<script>
let data = JSON.parse(localStorage.getItem('loanData') || '{}');
data.people ||= [];
data.transactions ||= [];
data.settings ||= { currency:'', dark:false, password:'' };

function save() {
  localStorage.setItem('loanData', JSON.stringify(data));
  render();
}

function toggleDark() {
  data.settings.dark = !data.settings.dark;
  save();
}

function saveSettings() {
  data.settings.currency = currency.value;
  data.settings.password = password.value;
  save();
}

function addPerson() {
  if (!newPerson.value) return;
  data.people.push(newPerson.value);
  newPerson.value='';
  save();
}

function addTransaction() {
  if (!amount.value) return;
  data.transactions.push({
    id:Date.now(),
    person:personSelect.value,
    type:type.value,
    amount:+amount.value,
    date:new Date().toLocaleString()
  });
  amount.value='';
  save();
}

function deleteTransaction(id) {
  data.transactions = data.transactions.filter(t=>t.id!==id);
  save();
}

function exportData() {
  const blob = new Blob([JSON.stringify(data)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'loan-backup.json';
  a.click();
}

function importData(e) {
  const reader = new FileReader();
  reader.onload = () => {
    data = JSON.parse(reader.result);
    save();
  };
  reader.readAsText(e.target.files[0]);
}

function render() {
  document.body.className = data.settings.dark ? 'dark' : '';
  currency.value = data.settings.currency || '';
  password.value = data.settings.password || '';

  personSelect.innerHTML = data.people.map(p=>`<option>${p}</option>`).join('');

  let balances = {}, total=0;
  data.transactions.forEach(t=>{
    balances[t.person] ||= 0;
    balances[t.person] += t.type==='borrow'?t.amount:-t.amount;
  });

  balancesDiv.innerHTML='';
  balancesDiv = document.getElementById('balances');
  balancesDiv.innerHTML='';
  for (let p in balances) {
    const v = balances[p]; total+=v;
    balancesDiv.innerHTML +=
      `<div class="${v>=0?'positive':'negative'}">${p}: ${data.settings.currency}${v}</div>`;
  }
  totalSpan=document.getElementById('total');
  totalSpan.textContent = data.settings.currency + total;

  history.innerHTML='';
  data.transactions.slice().reverse().forEach(t=>{
    history.innerHTML+=`
      <div class="list-item">
        <span>${t.date} ‚Äî ${t.person} ‚Äî ${t.type} ${data.settings.currency}${t.amount}</span>
        <span onclick="deleteTransaction(${t.id})">‚ùå</span>
      </div>`;
  });
}

if (data.settings.password) {
  let p = prompt("Enter password");
  if (p !== data.settings.password) document.body.innerHTML="Locked";
}

render();
</script>

</body>
</html>
